<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="Keywords" content="" />
<meta name="Description" content="" />
<title>汇博网_第三方账号绑定</title>
<!–[if lt IE9]> 
<script src="{/version file='html5.js'/}"></script>  
<![endif]–>
<link rel="stylesheet" type="text/css" href="{/version file='base.css'/}" />
<link rel="stylesheet" type="text/css" href="{/version file='login.css'/}" />
<link rel="stylesheet" type="text/css" href="{/version file='icons.css'/}" />
<script type="text/javascript" language="javascript" src="{/version file='jquery-1.8.3.js'/}"></script>
<script type="text/javascript" language="javascript" src="{/version file='common.js'/}"></script>
<script type="text/javascript" language="javascript" src="{/version file='dialog.js'/}"></script>
<script type="text/javascript" language="javascript" src="{/version file='jquery.form.js'/}"></script>
<script type="text/javascript" language="javascript" src="{/version file='ui_validate.js'/}"></script>
<script type="text/javascript" language="javascript" src='{/version file="ui_dropdownlist.js"/}'></script>
</head>
<style type="text/css">
	.workExp .r {margin-top: 7px;}
	.icon-chck em,.icon-chck-checked em,.icon-rad em,.icon-rad-checked em{display: inline-block;width:16px;height: 16px;background:url({/$siteurl.style/}/img/v2/resume/icon.jpg) 0 -180px no-repeat;margin-right: 5px;vertical-align: -4px;#vertical-align: -1px;_vertical-align: 1px}
	.icon-rad em,.icon-rad-checked em{width:18px;height: 18px;background-position:-26px -180px}
	.icon-rad-checked em{background-position:-82px -180px}
	.icon-chck-checked em{background-position: -54px -180px;width:18px;height: 18px}
</style>
<body>
<header>
	<div class="headerCon thirdHeader">
    	<div class="logo thirdLogo"><a href="{/$siteurl.main/}"></a></div>
    </div>
</header>
<section class="content" id="content">
	
	<div class="reg thirdLog">
        <span class="tipTxt">
            <p>hi，<span class="orange">{/$name/}</span>，您在汇博网有简历吗？</p>
        </span>
         <div class="thirdBox" id="tab">
        	<div class="tabT" id="swPanel">
            	<ul>
                	<li class="cu"><a href="javascript:void(0);">没注册过，没简历</a></li>
                    <li><a href="javascript:void(0);">注册过，有简历</a></li>
                </ul>
            </div>
            <div class="tabC" id="tabContainer">
                <div class="tabCon">
                <form id="form1" action="{/get_url rule="/resumeModel/regThirdLoginBind/"/}" method="post">
                	<input type="hidden" name="hidThirdID" value="{/$open_id/}" />
         			<input type="hidden" name="hidThirdLoginType" value="{/$third_login_type/}" />
                    <div class="formMod">
                        <div class="l">手机号码</div>
                        <div class="r"><span class="formText">
                            <input type="text" id="txtMobilPhone" name="txtMobilPhone" style="width:260px;" class="text" />
                            </span>
                            <span class="tipPos">
                                <span class="tipLay">
                                   
                                </span>
                            </span>
                            <span class="tipTxt">便于招聘企业联系您</span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="formMod">
                        <div class="l">验证码</div>
                        <div class="r">
                            <span class="formText"><input type="text" id="txtMobilPhoneCode" name="txtMobilPhoneCode" style="width:101px;" class="text" /></span>
                            <span class="phoneBtn"><a href="javascript:void(0);" id="btnSendMsg" class="btn3 btnsF16 clickValidate">免费获取验证码</a></span>
                            <span class="tipPos">
                                <span class="tipLay">
                                    
                                </span>
                            </span>
                            <span class="tipTxt">验证手机真实性，以保证您能及时收到面试通知</span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="formMod">
                        <div class="l">密码</div>
                        <div class="r">
                            <span class="formText"><input type="password" id="txtPassword" name="txtPassword" style="width:260px;" class="text" /></span>
                            <span class="tipPos">
                                <span class="tipLay">
                                    
                                </span>
                            </span>
                            <span style="clear:both;width:100%;margin:0;display:none;" class="tipTxt"  id="pwdTipTxt">密码强度：<em class="red">弱</em></span>
                            <span class="tipTxt">保障您的简历安全</span>
                        </div>
                        <div class="clear"></div>
                    </div>
					<div class="formMod workExp">
                        <div class="l">工作经验</div>
                        <div class="r pt10">
                            <label data-value="1" data-name="radWorkState" class="icon-rad icon-rad-checked" for="exp1" data-status="true"><em></em>已参加工作<input type="radio" value="1" name="radWorkState" style="display: none;" checked="checked"></label>
                            <label data-value="2" data-name="radWorkState" class="mgl10 icon-rad" for="exp2"><em></em>目前在读/应届生<input type="radio" value="2" name="radWorkState" style="display: none;"></label>
                            <p class="prompt-msg msg" data-for="radWorkState"></p>
                        </div>
                        <div class="clear"></div>
                    </div>
					<div class="formMod">
						<div class="l"></div>
						<div class="r">
							<span id="ddlMailSource" class="drop zindex"></span>
							<span id="ddlMailSourceSchool" class="drop zindex" style="display:none"></span>
						</div>
						<div class="clear"></div>
					</div>
					<div class="formMod" id="boxMailOtherSource" style="display:none;">
						<span class="formText">
						    <input type="text" style="width:280px;" id="txtOtherSource" name="txtOtherSource" watermark="说说从那里知道的吧！" autocomplete="off" class="text watermark" />
						</span>
						<span class="tipPos">
					    	<span class="tipLay">
					    	</span>
						</span>
					</div>
                    <div class="formBtn"><a href="javascript:void(0);" id="btnRegister" class="btn1 btnsF16">绑定</a></div>
                </form>
                </div>
                <div class="tabCon" id="tabPanel2" style="display:none;">
                	<div id="tipError">
            			<div class="testTxt" style="display:none;"><i class="hbFntWes">&#xf057;</i><div class="clear"></div></div>
            		</div>
                    <form id="form2" action="{/get_url rule="/resumeModel/thirdLoginBind/"/}" method="post">
                    <input type="hidden" id="open_id"  value="{/$open_id/}" />
         			<input type="hidden" id="third_type" value="{/$third_login_type/}" />
                    <span class="tit">输入您在汇博网的账号和密码，以后使用QQ登录也能维护简历并投递了！</span>
                    <div class="formMod">
                        <div class="l">账号</div>
                        <div class="r"><span class="formText">
                            <input type="text" id="user_name" name="user_name" style="width:260px;" class="text" />
                            </span>
                            <span class="tipPos">
                                <span class="tipLay">
                                    
                                </span>
                            </span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="formMod">
                        <div class="l">密码</div>
                        <div class="r">
                            <span class="formText"><input type="password" id="password" name="password" style="width:260px;" class="text" /></span>
                            <span class="tipPos">
                                <span class="tipLay">
                                    
                                </span>
                            </span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="formMod" id="verifycode" {/if $isShowAuthCode/} style="margin-bottom:15px;" {/else/}style="margin-bottom:15px;display:none" {//if/}>
                     	<div class="l">验证码</div>
                     	<div class="r">
                     	<input type="hidden" value="{/$seed/}" name="seed" id='login_seed'/>
                     	 <span class="formText"><input type="text" style="width:80px;" id="catcha" name="catcha" class="text" /><div class="errTxt" style="width:83px;"></div></span>
                        <span class="yzImg" style="float: left;margin-left: 10px;">
							<img id="imgCode" src='{/get_url rule="/resumeModel/verify" data="seed={/$seed/}"/}'/></span>
                        <span class="tipTxt" style="margin-left: 10px;width: auto;"><a id="btnCode" href="javascript:void(0)">换一换</a></span>
                     	</div>
                        <div class="clear"></div>
                    </div>
                     <div class="formMod">
                        <div class="l"></div>
                        
                        <div class="r">
                           <span class="formText"><a target="_blank" href="{/get_url rule="/resumeModel/findpassword/"/}" style="width:100%; color:#0099CC; text-align:center;text-decoration:underline;" >忘记密码?</a></span>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="formBtn"><a href="javascript:void(0);" id="btnLogin" class="btn1 btnsF16">绑定简历</a></div>
               		</form>
                </div>
            </div>
        </div>
    </div>
</section>
{/include file="./footer.html"/}
<script type="text/javascript">

//密码验证规则
$.validator.addMethod("inputPhoneRegValiPwd", function(value, element) {
    var pwd = $('#txtPassword').val();
    var userName = $('#txtUserID').val();
    var patten = new RegExp('^[0-9]+$');
    if (userName == pwd) {
        errorMsg = "密码和用户名不能相同<span class='tipArr'></span>";
        return false;
    }
    if (/^(\d)\1+$/.test(pwd)){ 
        errorMsg = "密码不能为同一个数字<span class='tipArr'></span>";
        return false;
    }
    var str = pwd.replace(/\d/g, function($0, pos) {
        return parseInt($0)-pos;
    });
    if (/^(\d)\1+$/.test(str)){
    	 errorMsg = "密码不能为连续数字<span class='tipArr'></span>";
         return false;
    }
    str = pwd.replace(/\d/g, function($0, pos) {
        return parseInt($0)+pos;
    });
    if (/^(\d)\1+$/.test(str)){
    	 errorMsg = "密码不能为连续数字<span class='tipArr'></span>";
         return false;
    }
    return true;
}, function() { return errorMsg; });

var thirdlogin={
	formValid1:null,	
	formValid2:null,
	init:function(){
		$('#swPanel').find('li').click(function(){
			var _this = $(this);
			if(_this.hasClass('cu')){
				return false;
			}else{
				var thisIndex = _this.index();
				_this.addClass('cu').siblings('li').removeClass('cu');
				$('#tabContainer').find('.tabCon').eq(thisIndex).show().siblings('.tabCon').hide();
			}
		});
		$('#btnBind').live('click',function(){
			$('#swPanel').find('li').eq(1).addClass('cu').siblings('li').removeClass('cu');
			$('#tabContainer').find('.tabCon').eq(1).show().siblings('.tabCon').hide();
			$('#user_name').val($('#txtMobilPhone').val());
		});
		thirdlogin.personlogin.initialize();
		thirdlogin.reg.initialize();
	},
	reg:{
		initialize:function(){
			$('#btnSendMsg').on('click', function() {
				if ($(this).hasClass("clickValidate"))
					thirdlogin.reg.sendMsg();
			});
			$('#txtPassword').focus(function(){
				intervalPwd = window.setInterval(thirdlogin.reg.pwdDynamic,200);
			});
			$('#btnRegister').click(function(){
				$(this).submitForm({ beforeSubmit: $.proxy(thirdlogin.formValid1.form, thirdlogin.formValid1),success:thirdlogin.reg.success,clearForm:false});
			});
			thirdlogin.formValid1=$("#form1").validate({
				rules:{
					txtMobilPhone:{
						required:true,
						match:/^[1]\d{10}$/,			
						remote:{
						  url: "{/get_url rule='/resumeModel/checkphone'/}",
						  type: "post", 
						  dataType: "json",
			              data: { 
				              mobilphone: function() { return $("#txtMobilPhone").val(); } 
			              },
			              dataFilter: function(json) {
			                  var result = eval('(' + json + ')');	                     
			                  if (result && result.success == "true") {
			                      return "true";
			                  }
			                  else {
			                      return "false";
			                  }
			              }
			           }
					},
					txtMobilPhoneCode:{
						required:true,
						match:/\d{6}$/
					},
					txtPassword:{required:true,rangelength: [6,16],inputPhoneRegValiPwd:true},
				},
				messages:{
					txtMobilPhone:{
						required:'请输入手机号码<span class="tipArr"></span>',
						match:'请输入正确的手机号码<span class="tipArr"></span>',
						remote:'该手机号已被注册,尝试<a href="javascript:void(0)" id="btnBind">绑定账号</a><span class="tipArr"></span>'
					},
					txtMobilPhoneCode:{
						required:'请输入验证码<span class="tipArr"></span>',
						match:'请输入正确的验证码<span class="tipArr"></span>'
					},
					txtPassword:{
						required:'请输入密码<span class="tipArr"></span>',
						rangelength:'密码只能输入6-16位字符<span class="tipArr"></span>'
					}
				},
				errorClasses:{
					txtMobilPhone:{
						required:'tipLayErr tipw120',
						match:'tipLayErr tipw150',
						remote:'tipLayErr tipw200'
					},
					txtMobilPhoneCode:{
						required:'tipLayErr tipw120',
						match:'tipLayErr tipw150'
					},
					
					txtPassword:{
						required:'tipLayErr tipw120',
						rangelength:'tipLayErr tipw150',
						inputPhoneRegValiPwd:'tipLayErr tipw150'
					}
				},
				tipClasses:{
					txtMobilPhone:'tipLayTxt tipw120',
					txtMobilPhoneCode:'tipLayTxt tipw120',
					txtPassword:'tipLayTxt tipw120'
					
				},
				tips:{
					txtMobilPhone:'请输入手机号码<span class="tipArr"></span>',	
					txtMobilPhoneCode:'请输入验证码<span class="tipArr"></span>',
					txtPassword:'请输入密码<span class="tipArr"></span>'
				},
				errorElement:'span',
				errorPlacement:function(error,element){
					element.closest('div.formMod').find('.tipPos .tipLay').append(error);
				},
				success:function(label){
					label.text(" ");
				}
			});
		},
	    countdown:function(){
	    	var seconds=$('#btnSendMsg').find('i').html();
	 		seconds = parseInt(seconds);
	 		if(seconds>0){
	 			seconds--;
	 			$('#btnSendMsg').find('i').html(seconds);
	 		} else {
	 			window.clearInterval(interval);
	 			$('#btnSendMsg').removeClass('btn3Unclick').addClass("clickValidate").html('免费获取验证码');
	 		}
	     },
	     sendMsg:function(){
	         var fn = this;
	    	 if(thirdlogin.formValid1.element($('#txtMobilPhone'))){
					var mobilePhone=$('#txtMobilPhone').val();
					// $.getJSON('{/get_url rule="/register/getAuthCode" data="txtPhone='+mobilePhone+'"/}',function(json){
					// 	if(json&&json.error){
					// 		$('#btnSendMsg').bind('click',function(){
					// 			thirdlogin.reg.sendMsg();
				 // 			});
					// 		$.message(json.error,{title:'操作失败！'});
					// 		return;
					// 	}
					// 	$('#btnSendMsg').html('<i>59</i>秒后可重新获取验证码').addClass('btn3Unclick');
					// 	interval = window.setInterval(thirdlogin.reg.countdown,1000);
					// });
					$.showModal("{/get_url rule='/register/qqvalidate/'/}"+"txtMobile-"+mobilePhone, {title:'请输入验证码'});
				}
	     },
	     pwdStrong:function(pwd){
	 		//密码强度计算
	 		var modes =0,pwd_len =pwd.length,i=0,codeTemp;
	 		for(i;i<pwd_len;i++){
	 			codeTemp = pwd.charCodeAt(i);
	 			if(codeTemp>=48 && codeTemp<=75){
	 				modes |=1;
	 			}
	 			else if(codeTemp>65&&codeTemp<=90){
	 				modes |=2;
	 			}
	 			else if(codeTemp>97 && codeTemp<122){
	 				modes |=4;
	 			}
	 			else{
	 				modes |=8;
	 			}
	 		}
	 		var modeNum=0;
	 		for(i=0;i<4;i++){
	 			if(modes & 1) modeNum++;
	 			modes>>>=1;
	 		}
	 		return modeNum;
	 	},
	 	pwdDynamic:function(){
	 		var password  = $('#txtPassword').val(),strongBox = $('#pwdTipTxt'),fn = this;
	 		if(password == ''){
	 			strongBox.hide();
	 			return;
	 		}
	 		strongBox.show();
	 		var modeNum = thirdlogin.reg.pwdStrong(password);
	 		if(modeNum <=1){
	 			$(strongBox).find('em').removeClass().addClass('red').html('弱');
	 		}
	 		else if(modeNum == 2){
	 			if(password.length<6){
	 				$(strongBox).find('em').removeClass().addClass('red').html('弱');
	 			}
	 			else{
	 				$(strongBox).find('em').removeClass().addClass('orange').html('中');
	 			}
	 		}
	 		else if(modeNum >2){
	 			if(password.length<6){
	 				$(strongBox).find('em').removeClass().addClass('red').html('弱');
	 			}
	 			else if(password.length > 6 && password.length<10){
	 				$(strongBox).find('em').removeClass().addClass('orange').html('中');
	 			}
	 			else{
	 				$(strongBox).find('em').removeClass().addClass('green').html('强');
	 			}
	 		}
	 	},
	 	success:function(json){
			if(json&&json.error){
				$.message(json.error,{title:'操作失败！'});
				return;
			}else{
				 var workstate=$('input[name="radWorkState"]:checked').val();
				$.anchorMsg(json.success, { icon: 'success', onclose: function(){
					window.location.href = json.url;
				}});
			}
			//window.location.href = json.url;	
	 	}
	},
	personlogin:{
		checkNeedAuth:function(){
			var user_name = $('#user_name').val();
			if(user_name == "" || $('#verifycode').is(":visible")) {
				return ;
			}
			else{
				$.ajax({
					url:"{/geturl rule='/resumeModel/NeedAuthCode'/}",
					type:"post",
					data:{user_name:user_name},
					dataType:"json",
					success:function(json){
						if(json.needAuthCode == "true"){
							$('#verifycode').show();
						}
						else{
							$('#verifycode').hide();
						}	
					}
				});
			}
		},
        initialize:function(){
			thirdlogin.formValid2 = $("#form2").validate({
				rules:{
					user_name:{required:true},
					password:{required:true,rangelength: [6,16]},
					catcha:{required:true}
				},
				messages:{
					user_name:{required:'<i class="hbFntWes">&#xf057;</i><p>请输入用户名</p><div class="clear"></div>'},
					password:{required:'<i class="hbFntWes">&#xf057;</i><p>请输入密码</p><div class="clear"></div>',rangelength:'<i class="hbFntWes">&#xf057;</i><p>密码只能输入6-16位字符</p><div class="clear"></div>'},
					catcha:{required:'<i class="hbFntWes">&#xf057;</i><p>请输入验证码</p><div class="clear"></div>'}
				},
				errorClasses:{
					user_name:{required:'testTxt'},
					password:{required:'testTxt',rangelength:'testTxt'},
					catcha:{required:'testTxt'}
				},
				errorElement:'div',
				errorPlacement:function(error,element){		
					$('#tipError').html(error);		
				},
				success:function(label){
					label.text(" ");
				}
			});
            $('#form2').find(':input').keydown(function(event) {
                var e = $.event.fix(event);
                if (e.keyCode == 13) {
                    $('#form2').find('#btnLogin').click();
                }
            });

            var sourceItems = [];
			{/foreach $source_data as $key => $name/}
			sourceItems.push({id:'{/$key/}',name:'{/$name/}'});
			{//foreach/}

			var schoolsourceItems = [];
			{/foreach $school_source_data as $key => $name/}
			schoolsourceItems.push({id:'{/$key/}',name:'{/$name/}'});
			{//foreach/}

            var rlabel = $("label[data-name='radWorkState']");
			rlabel.click(function() {
				$(this).siblings("label[data-name='radWorkState']").find("input[type='radio']").removeAttr("checked");
				$(this).siblings("label[data-name='radWorkState']").removeClass("icon-rad-checked");
				$(this).addClass("icon-rad-checked").find("input[type='radio']").attr("checked", "checked");
				if ($(this).find("input[type='radio']").val() == 1) {
					$("#ddlMobilSource").show();
					$("#ddlMailSource").show();
					$("#ddlMobilSourceSchool").hide();
					$("#ddlMailSourceSchool").hide();
				} else {
					$("#ddlMobilSource").hide();
					$("#ddlMailSource").hide();
					$("#ddlMobilSourceSchool").show();
					$("#ddlMailSourceSchool").show();
				}
			});

			// 增加验证码
	        $('#ddlMobilSource').droplist({defaultTitle:'您是从哪儿知道汇博网？',isCanWrite:false,inputWidth:285,style:'width:293px;',hddName:'ddlMobilSource',items:sourceItems,onSelect:function(i,name){
	        	$('#boxOtherSource').hide().find('input').val('');
				if(i==7){
					$('#boxOtherSource').show();
				}
			}});

	        $('#ddlMailSource').droplist({defaultTitle:'您是从哪儿知道汇博网？',isCanWrite:false,inputWidth:285,style:'width:293px;',hddName:'ddlMailSource',items:sourceItems,onSelect:function(i,name){
	        	$('#boxMailOtherSource').hide().find('input').val('');
				if(i==7){
					$('#boxMailOtherSource').show();
				}
	        }});
	        $('#ddlMobilSourceSchool').droplist({defaultTitle:'您是从哪儿知道汇博网？',isCanWrite:false,inputWidth:285,style:'width:293px;',hddName:'ddlMobilSourceSchool',items:schoolsourceItems,onSelect:function(i,name){
	        	$('#boxOtherSource').hide().find('input').val('');
				if (i == 18) {
					$('#boxOtherSource').show();
				}
	    	}});
	        $('#ddlMailSourceSchool').droplist({defaultTitle:'您是从哪儿知道汇博网？',isCanWrite:false,inputWidth:285,style:'width:293px;',hddName:'ddlMailSourceSchool',items:schoolsourceItems,onSelect:function(i,name){
	        	$('#boxMailOtherSource').hide().find('input').val('');
				if (i == 18) {
					$('#boxMailOtherSource').show();
				}
	        }});

            //验证码
            $('#imgCode,#btnCode').click(function(){
				$(this).closest('.formMod').find('img').attr('src','/resumeModel/verify?seed={/$seed/}&r='+Math.random());
				return false;
			});

			this.checkNeedAuth();
			$('#user_name').blur(function(){
				thirdlogin.personlogin.checkNeedAuth();
			});
			
            $("#btnLogin").click(function() {
				var user_name,password,catcha,seed,open_id,third_type,chkSave;
				if(thirdlogin.formValid2.element($('#user_name'))&&thirdlogin.formValid2.element($('#password'))){						
					if(!$('#verifycode').is(':hidden')){
						if(!thirdlogin.formValid2.element($('#catcha'))){
							return;
						}
					}
					user_name = $("#user_name").val();
					password = $("#password").val();
					catcha = $("#catcha").val();
					seed = $("#login_seed").val();
					open_id = $('#open_id').val();
					third_type = $('#third_type').val();
					//chkSave = $("#chkSave").is(':checked')?'true':'false';
					$("#btnLogin").running('正在提交数据');
					$.ajax({
						url:"{/geturl rule='/resumeModel/thirdLoginBind'/}",
						type:"post",
						data:{user_name:user_name,password:password,catcha:catcha,seed:seed,open_id:open_id,third_type:third_type},
						dataType:"json",
						success:function(json){
							if(json.error){
								$("#btnLogin").stopRunning();
								if(json.error=='请输入验证码' || json.error=='验证码错误'){
									$('#tipError').html('<div class="testTxt" for="catcha" generated="true"><i class="hbFntWes">&#xf057;</i><p>'+json.error+'</p><div class="clear"></div></div>').show();
									$('#catcha').focus();
									$('#catcha').val('');
								}else{
									$('#tipError').html('<div class="testTxt"><i class="hbFntWes">&#xf057;</i><p>'+json.error+'</p><div class="clear"></div></div>').show();										
									$('#password').val('');
									$('#catcha').val('');
								}
								$('#imgCode').click();
								if(json.needAuthCode){
									$('#verifycode').show();
								}
								return;
							}
							$("#btnLogin").stopRunning();
							$.anchorMsg(json.success, { icon: 'success', onclose: function(){
	                        	 window.location.href = json.url;
	                        }});				
						}
					});
				}		
			});
		}
	}
}
thirdlogin.init();


</script>
{/include file="statistics.html"/}
</body>
</html>
